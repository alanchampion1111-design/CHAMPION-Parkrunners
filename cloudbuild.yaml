options:
  logging: CLOUD_LOGGING_ONLY
  
steps:
  # Build the Docker image
  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'gcr.io/parkrun-champions/browser-automation-service', '.']

  # Deploy to Cloud Run
  - name: 'gcr.io/cloud-builders/gcloud'
    args: [ 'run','deploy','browser-automation-service',
            '--image=gcr.io/parkrun-champions/browser-automation-service',
            '--platform=managed','--allow-unauthenticated','--port=8080',
            '--region=europe-west1','--set-env-vars=^:^NODE_ENV=production',
            '--memory=2Gi','--cpu=1','--min-instances=0','--max-instances=1'
          ]
          
# Store the image in Artifact Registry
images:
  - 'gcr.io/parkrun-champions/browser-automation-service'
  
